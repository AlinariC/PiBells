<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/static/icons/icon-192.png">
  <meta name="theme-color" content="#4facfe">
  <title>Button Configuration</title>
  <link rel="stylesheet" href="/static/style.css">
  <link rel="stylesheet" href="/static/css/all.min.css">
</head>
<body>
  <header>
    <img src="/static/pibells-logo.png" alt="PiBells logo" class="logo" />
    <div id="current-time"></div>
    <nav>
      <a href="/"><span class="icon"><i class="fa-solid fa-arrow-left"></i></span> Back to Schedule</a>
      <a href="/logout"><span class="icon"><i class="fa-solid fa-right-from-bracket"></i></span> Logout</a>
    </nav>
  </header>
  <h1>Quick Buttons</h1>
  <form id="add-form">
    <label>Name: <input type="text" id="name" required></label>
    <label>Sound: <select id="sound"></select></label>
    <label>Color: <input type="color" id="color" value="#ff0000"></label>
    <label>Icon:
      <select id="icon">
        <option value="">None</option>
        <option value="fa-bell">Bell</option>
        <option value="fa-fire">Fire</option>
        <option value="fa-exclamation-triangle">Warning</option>
        <option value="fa-ambulance">Ambulance</option>
      </select>
    </label>
    <button type="submit" class="btn"><span class="icon"><i class="fa-solid fa-plus"></i></span> Add</button>
  </form>
  <table id="buttons">
    <thead><tr><th>Name</th><th>Sound</th><th>Icon</th><th>Color</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>
<script>
let audioMap = {};
async function loadAudio() {
  const res = await fetch('/api/audio');
  const data = await res.json();
  const select = document.getElementById('sound');
  if (!select) return;
  select.innerHTML = '';
  audioMap = {};
  data.forEach(file => {
    const opt = document.createElement('option');
    opt.value = file.file;
    opt.textContent = file.name;
    select.appendChild(opt);
    audioMap[file.file] = file.name;
  });
}

async function loadButtons() {
  const res = await fetch('/api/buttons');
  const data = await res.json();
  const tbody = document.querySelector('#buttons tbody');
  tbody.innerHTML = '';
  const iconMap = {
    'fa-bell': '<i class="fa-solid fa-bell"></i>',
    'fa-fire': '<i class="fa-solid fa-fire"></i>',
    'fa-exclamation-triangle': '<i class="fa-solid fa-triangle-exclamation"></i>',
    'fa-ambulance': '<i class="fa-solid fa-truck-medical"></i>'
  };
  data.forEach((btn, i) => {
    const tr = document.createElement('tr');
    const sound = audioMap[btn.sound_file] || btn.sound_file;
    const icon = iconMap[btn.icon] || btn.icon || '';
    const iconHtml = icon ? `<span class="icon">${icon}</span>` : '';
    tr.innerHTML = `<td>${btn.name}</td><td>${sound}</td><td>${iconHtml}</td><td><span style="background:${btn.color};padding:5px 10px;display:inline-block"></span></td>`;
    const del = document.createElement('button');
    del.className = 'btn btn-danger';
    del.innerHTML = '<span class="icon"><i class="fa-solid fa-trash"></i></span> Delete';
    del.onclick = async () => {
      await fetch('/api/buttons/' + i, { method: 'DELETE' });
      loadButtons();
    };
    const td = document.createElement('td');
    td.appendChild(del);
    tr.appendChild(td);
    tbody.appendChild(tr);
  });
}

document.getElementById('add-form').onsubmit = async (e) => {
  e.preventDefault();
  const name = document.getElementById('name').value;
  const sound = document.getElementById('sound').value;
  const color = document.getElementById('color').value;
  const icon = document.getElementById('icon').value;
  await fetch('/api/buttons', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name, sound_file: sound, color, icon })
  });
  e.target.reset();
  loadButtons();
};

  loadAudio();
  loadButtons();
  function updateTime() {
    const now = new Date();
    const pad = n => n.toString().padStart(2, '0');
    const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
    let hours = now.getHours();
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    if (hours === 0) hours = 12;
    const str = `${days[now.getDay()]} ${pad(hours)}:${pad(now.getMinutes())}:${pad(now.getSeconds())} ${ampm}`;
    document.getElementById('current-time').textContent = str;
  }
  updateTime();
  setInterval(updateTime, 1000);
</script>
  <footer>
    <div class="footer-left">
      <img src="/static/smallroundlogo.png" alt="PixelPacific logo" class="footer-logo" />
      <span>&copy; 2025 <a href="https://www.pixelpacific.com" target="_blank">PixelPacific LLC.</a></span>
    </div>
    <div class="theme-switch">
      <button class="theme-btn" data-theme="light" title="Light"><i class="fa-solid fa-sun"></i></button>
      <button class="theme-btn" data-theme="auto" title="Auto"><i class="fa-solid fa-circle-half-stroke"></i></button>
      <button class="theme-btn" data-theme="dark" title="Dark"><i class="fa-solid fa-moon"></i></button>
    </div>
    <div id="hostname" class="footer-right"></div>
  </footer>
  <script>
  async function loadHostname() {
    try {
      const res = await fetch('/api/network');
      const data = await res.json();
      document.getElementById('hostname').textContent = `${data.hostname} - ${data.ip}`;
    } catch (e) {
      console.error(e);
    }
  }
  loadHostname();
  </script>
  <script src="/static/theme.js"></script>
</body>
</html>
